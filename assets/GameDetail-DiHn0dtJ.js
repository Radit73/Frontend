import{e as K,r as t,g as S,j as e,f as H,b as R,a as I,h as q,i as V}from"./index-Bfh4GqGX.js";import{R as E,G as z}from"./GameCard-D1hESZt-.js";import{S as h}from"./SectionTitle-CkaZkgX6.js";import{g as G}from"./theme-eDaETbEk.js";const J=i=>{const s=Number(i)||0;return[{aspect:"Gameplay",score:`${Math.min(10,s+1).toFixed(1)} / 10`},{aspect:"Story",score:`${Math.max(6,s-.3).toFixed(1)} / 10`},{aspect:"Visual",score:`${Math.min(10,s+1.3).toFixed(1)} / 10`},{aspect:"Audio",score:`${Math.min(10,s+.8).toFixed(1)} / 10`},{aspect:"Performansi",score:`${Math.min(10,s+.5).toFixed(1)} / 10`}]},X=()=>{const{id:i}=K(),[s,L]=t.useState(null),[g,u]=t.useState([]),[p,x]=t.useState([]),[C,j]=t.useState(!0),[v,f]=t.useState(""),[l,N]=t.useState({rating:"10",comment:""}),[_,m]=t.useState(""),[w,b]=t.useState(!1),[d,P]=t.useState(S()),[c,D]=t.useState(()=>G());t.useEffect(()=>{const a=()=>P(S());return window.addEventListener("auth-changed",a),()=>window.removeEventListener("auth-changed",a)},[]),t.useEffect(()=>{const a=()=>D(G());return window.addEventListener("theme-changed",a),()=>window.removeEventListener("theme-changed",a)},[]),t.useEffect(()=>{const a=document.body;return a.classList.add("theme-page-game-detail"),c==="light"?a.classList.add("theme-light"):a.classList.remove("theme-light"),()=>{a.classList.remove("theme-page-game-detail"),a.classList.remove("theme-light")}},[c]),t.useEffect(()=>{(async()=>{try{j(!0),f("");const[r,n]=await Promise.all([H(i),R(i)]);L(r),u(n)}catch(r){f(r.message)}finally{j(!1)}})()},[i]),t.useEffect(()=>{(async()=>{try{const n=(await I()).filter(A=>String(A.id)!==String(i));x(n.slice(0,4))}catch{x([])}})()},[i]);const k=a=>{N({...l,[a.target.name]:a.target.value})},F=async()=>{const a=await R(i);u(a)},$=async a=>{if(a.preventDefault(),!d){m("Harus login untuk menulis review.");return}if(!l.comment.trim()){m("Komentar tidak boleh kosong.");return}try{b(!0),m(""),await q(i,{rating:Number(l.rating),comment:l.comment.trim()},V()),N({rating:"10",comment:""}),await F()}catch(r){m(r.message)}finally{b(!1)}};if(C)return e.jsx("div",{className:`page game-detail-page section ${c==="light"?"theme-light":""}`,children:e.jsx("p",{children:"Sedang memuat detail game..."})});if(v||!s)return e.jsx("div",{className:`page game-detail-page section ${c==="light"?"theme-light":""}`,children:e.jsx("p",{className:"error-text",children:v||"Game tidak ditemukan."})});const M=s.platform?s.platform.split(",").map(a=>a.trim()):[],B=s.genres?s.genres.split(",").map(a=>a.trim()):[],T=s.description?s.description.split(`
`).filter(a=>a.trim().length>0):["Belum ada deskripsi lengkap untuk game ini."],o=Number(s.avg_rating||0).toFixed(1),y=Number(s.review_count||0);return J(s.avg_rating),e.jsxs("div",{className:`page game-detail-page ${c==="light"?"theme-light":""}`,children:[e.jsxs("section",{className:"section detail-hero",children:[e.jsxs("p",{className:"detail-hero__breadcrumb",children:["Game #",i," • Eksklusif Portal Review Lokal"]}),e.jsxs("div",{className:"game-detail__header card",children:[e.jsx("div",{className:"game-detail__cover",children:e.jsx("img",{src:s.cover_image||"https://images.unsplash.com/photo-1472457974886-0ebcd59440cc?auto=format&fit=crop&w=900&q=80",alt:s.title})}),e.jsxs("div",{className:"game-detail__info",children:[e.jsx("p",{className:"game-detail__tag",children:s.title}),e.jsx("h1",{children:s.title}),e.jsxs("p",{className:"detail-subtitle",children:["oleh ",e.jsx("strong",{children:s.developer||"-"})," • dipublikasikan"," ",e.jsx("strong",{children:s.publisher||"-"})]}),e.jsxs("div",{className:"detail-badges",children:[M.map(a=>e.jsx("span",{className:"badge badge--solid",children:a},a)),B.map(a=>e.jsx("span",{className:"badge badge--outline",children:a},a))]}),e.jsxs("div",{className:"game-detail__rating",children:[e.jsxs("div",{children:[e.jsx("span",{className:"game-detail__rating-number",children:o}),e.jsxs("p",{className:"rating-caption",children:["Rata-rata ",y," review komunitas"]})]}),e.jsx(E,{rating:o>=8?"Hot Pick":"Community Choice"})]}),e.jsxs("div",{className:"detail-meta",children:[e.jsxs("div",{className:"detail-meta__item",children:[e.jsx("span",{children:"Rilis"}),e.jsx("strong",{children:s.release_date||"-"})]}),e.jsxs("div",{className:"detail-meta__item",children:[e.jsx("span",{children:"Platform"}),e.jsx("strong",{children:s.platform||"-"})]}),e.jsxs("div",{className:"detail-meta__item",children:[e.jsx("span",{children:"Mode"}),e.jsx("strong",{children:s.mode||"Single / Co-op"})]})]})]})]})]}),e.jsx("section",{className:"section",children:e.jsxs("div",{className:"card detail-summary",children:[e.jsx(h,{title:"Ringkasan"}),T.map((a,r)=>e.jsx("p",{children:a},r))]})}),e.jsx("section",{className:"section",children:e.jsxs("div",{className:"card game-detail__players",children:[e.jsx(h,{title:"Review Pemain",subtitle:"Langsung dari komunitas gamer lokal."}),e.jsxs("div",{className:"player-rating",children:[e.jsx("p",{children:"Skor Pemain"}),e.jsxs("h3",{children:[o," / 10 ",e.jsxs("span",{children:["• ",y," review"]})]})]}),d&&e.jsxs("form",{className:"user-review-form",onSubmit:$,children:[_&&e.jsx("p",{className:"error-text",children:_}),e.jsxs("label",{children:["Pilih Rating",e.jsx("select",{name:"rating",value:l.rating,onChange:k,children:[...Array(10)].map((a,r)=>{const n=10-r;return e.jsx("option",{value:n,children:n},n)})})]}),e.jsxs("label",{children:["Komentar Kamu",e.jsx("textarea",{name:"comment",rows:4,placeholder:"Bagikan pengalaman bermainmu di sini...",value:l.comment,onChange:k})]}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:w,children:w?"Mengirim...":"Kirim Review"})]}),!d&&e.jsx("p",{className:"muted-text",children:"Masuk untuk menulis review versimu."}),e.jsxs("div",{className:"player-review-list",children:[g.length===0&&e.jsx("p",{className:"muted-text",children:"Belum ada review pemain untuk game ini."}),g.map(a=>e.jsxs("div",{className:"player-review",children:[e.jsxs("div",{className:"player-review__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"player-review__name",children:a.user_name}),e.jsx("span",{className:"player-review__date",children:new Date(a.created_at).toLocaleDateString("id-ID")})]}),e.jsx(E,{rating:`${a.rating} / 10`})]}),e.jsx("p",{children:a.comment})]},a.id))]})]})}),e.jsxs("section",{className:"section detail-related",children:[e.jsx(h,{title:"Game Terkait",subtitle:"Rekomendasi lain dari komunitas."}),e.jsxs("div",{className:"game-grid",children:[p.length===0&&e.jsx("p",{className:"muted-text",children:"Belum ada rekomendasi."}),p.map(a=>e.jsx(z,{game:a,compact:!0},a.id))]})]})]})};export{X as default};
