import{j as e,r as i,g as j,a as D,i as G}from"./index-_RlfeBLV.js";import{C as c,e as M,a as P,L as I,P as B,f as $,p as z,c as F,d as U}from"./index-CciEPKy6.js";import{S as b}from"./SidebarAdmin-Ai76bB7Y.js";import{S as u}from"./SectionTitle-P0FvPO9X.js";import{g as v}from"./theme-eDaETbEk.js";const O=({label:l,value:g,icon:s})=>e.jsxs("div",{className:"stat-card card",children:[e.jsx("div",{className:"stat-card__icon",children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-card__label",children:l}),e.jsx("h3",{children:g})]})]});c.register(P,I,B,$,z,F,U);c.defaults.color="#e5e7eb";c.defaults.borderColor="rgba(255, 255, 255, 0.08)";const Q=()=>{const[l,g]=i.useState(j()),[s,f]=i.useState([]),[x,N]=i.useState(!0),[p,k]=i.useState(""),[r,E]=i.useState(()=>v());if(i.useEffect(()=>{const t=()=>g(j());return window.addEventListener("auth-changed",t),()=>window.removeEventListener("auth-changed",t)},[]),i.useEffect(()=>{const t=()=>E(v());return window.addEventListener("theme-changed",t),()=>window.removeEventListener("theme-changed",t)},[]),i.useEffect(()=>{const t=document.body;return t.classList.add("theme-page-admin"),r==="light"?t.classList.add("theme-light"):t.classList.remove("theme-light"),()=>{t.classList.remove("theme-page-admin"),t.classList.remove("theme-light")}},[r]),i.useEffect(()=>{c.defaults.color=r==="light"?"#111827":"#e5e7eb",c.defaults.borderColor=r==="light"?"rgba(185, 28, 28, 0.18)":"rgba(255, 255, 255, 0.08)"},[r]),i.useEffect(()=>{(async()=>{if(!(!l||l.user.role!=="ADMIN"&&l.user.role!=="SUPER_ADMIN"))try{const a=await D(G());f(a)}catch(a){k(a.message)}finally{N(!1)}})()},[l]),!l||l.user.role!=="ADMIN"&&l.user.role!=="SUPER_ADMIN")return e.jsxs("div",{className:`admin-layout ${r==="light"?"theme-light":""}`,children:[e.jsx(b,{active:"Dashboard"}),e.jsx("main",{className:"admin-content",children:e.jsx("p",{className:"error-text",children:"Akses ditolak. Hanya admin yang dapat melihat halaman ini."})})]});const S=s.reduce((t,a)=>t+Number(a.review_count||0),0),y=s.length>0?(s.reduce((t,a)=>t+Number(a.avg_rating||0),0)/s.length).toFixed(1):"0.0",_=[{label:"Total Game",value:s.length,icon:"ðŸŽ®"},{label:"Total Review",value:S,icon:"ðŸ“"},{label:"Rata-rata Rating",value:y,icon:"â­"}],w=[...s].sort((t,a)=>Number(a.avg_rating)-Number(t.avg_rating)).slice(0,5),L=[...s].slice(0,5),h=i.useMemo(()=>{const t={};s.forEach(n=>{const d=(n.genres||"").split(",").map(m=>m.trim()).filter(Boolean),T=d.length>0?d:["Tidak ada genre"],A=Number(n.review_count||0);T.forEach(m=>{t[m]=(t[m]||0)+A})});const a=Object.entries(t).map(([n,d])=>({genre:n,count:d})).sort((n,d)=>d.count-n.count),o=a.length>0?Math.max(...a.map(n=>n.count)):0;return a.map(n=>({...n,normalized:o>0?n.count/o*10:0}))},[s]),R={labels:h.map(t=>t.genre),datasets:[{label:"Total skor rating",data:h.map(t=>t.normalized),borderColor:"#e11d48",backgroundColor:"rgba(225, 29, 72, 0.18)",pointBackgroundColor:"#f43f5e",pointBorderColor:"#0c0d0f",tension:.35,fill:!0}]},C={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:t=>{var o;return`Total rating: ${((o=h[t.dataIndex])==null?void 0:o.count)??0} (skala 0-10: ${t.parsed.y.toFixed(1)})`}}}},scales:{x:{grid:{color:r==="light"?"rgba(185, 28, 28, 0.12)":"rgba(255, 255, 255, 0.05)"},ticks:{maxRotation:0,color:r==="light"?"#111827":"#e5e7eb"}},y:{beginAtZero:!0,suggestedMax:10,grid:{color:r==="light"?"rgba(185, 28, 28, 0.12)":"rgba(255, 255, 255, 0.08)"},ticks:{precision:0,stepSize:1,color:r==="light"?"#111827":"#e5e7eb"}}}};return e.jsxs("div",{className:`admin-layout ${r==="light"?"theme-light":""}`,children:[e.jsx(b,{active:"Dashboard"}),e.jsxs("main",{className:"admin-content",children:[e.jsx("h1",{children:"Dashboard Admin"}),e.jsx("p",{className:"muted-text",children:"Pantau statistik portal review secara real-time."}),p&&e.jsx("p",{className:"error-text",children:p}),e.jsx("div",{className:"stat-grid",children:_.map(t=>e.jsx(O,{...t},t.label))}),e.jsxs("div",{className:"card",style:{marginTop:"2rem"},children:[e.jsx(u,{title:"Sebaran Rating per Genre",subtitle:"Diurutkan dari jumlah skor rating terbanyak hingga paling sedikit."}),x?e.jsx("p",{children:"Sedang memuat grafik rating per genre..."}):h.length===0?e.jsx("p",{children:"Belum ada data genre untuk ditampilkan."}):e.jsx("div",{className:"chart-container",children:e.jsx(M,{data:R,options:C})})]}),x?e.jsx("p",{children:"Sedang memuat data dashboard..."}):e.jsxs("div",{className:"admin-panels",children:[e.jsxs("div",{className:"card",children:[e.jsx(u,{title:"Game dengan Rating Tertinggi"}),e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Game"}),e.jsx("th",{children:"Developer"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Review"})]})}),e.jsx("tbody",{children:w.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.title}),e.jsx("td",{children:t.developer}),e.jsx("td",{children:Number(t.avg_rating||0).toFixed(1)}),e.jsx("td",{children:t.review_count})]},t.id))})]})]}),e.jsxs("div",{className:"card",children:[e.jsx(u,{title:"Game Terbaru"}),e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Game"}),e.jsx("th",{children:"Platform"}),e.jsx("th",{children:"Dirilis"})]})}),e.jsx("tbody",{children:L.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.title}),e.jsx("td",{children:t.platform}),e.jsx("td",{children:t.release_date||"-"})]},t.id))})]})]})]})]})]})};export{Q as default};
