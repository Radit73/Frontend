import{r as l,g as j,l as k,j as e,a as M,i as h,p as T,q as A,t as L}from"./index-_RlfeBLV.js";import{S as g}from"./SidebarAdmin-Ai76bB7Y.js";import{S as v}from"./SectionTitle-P0FvPO9X.js";import{g as b}from"./theme-eDaETbEk.js";const p={title:"",developer:"",publisher:"",platform:"",mode:"",genres:"",release_date:"",description:"",cover_image:""},U=()=>{const[t,f]=l.useState(j()),[N,C]=l.useState([]),[y,x]=l.useState(!0),[s,o]=l.useState(p),[r,m]=l.useState(null),{addToast:n}=k(),[c,G]=l.useState(()=>b()),u=async()=>{try{x(!0);const a=await M(h());C(a)}catch(a){n(a.message||"Gagal memuat daftar game.","error")}finally{x(!1)}};l.useEffect(()=>{const a=()=>f(j());return window.addEventListener("auth-changed",a),()=>window.removeEventListener("auth-changed",a)},[]),l.useEffect(()=>{const a=()=>G(b());return window.addEventListener("theme-changed",a),()=>window.removeEventListener("theme-changed",a)},[]),l.useEffect(()=>{const a=document.body;return a.classList.add("theme-page-admin"),c==="light"?a.classList.add("theme-light"):a.classList.remove("theme-light"),()=>{a.classList.remove("theme-page-admin"),a.classList.remove("theme-light")}},[c]),l.useEffect(()=>{var a,d;(((a=t==null?void 0:t.user)==null?void 0:a.role)==="ADMIN"||((d=t==null?void 0:t.user)==null?void 0:d.role)==="SUPER_ADMIN")&&u()},[t]);const i=a=>{o({...s,[a.target.name]:a.target.value})},S=async a=>{if(a.preventDefault(),!s.title||!s.description||!s.cover_image){n("Minimal judul, deskripsi, dan cover wajib diisi.","error");return}try{r?(await T(r,s,h()),n("Game berhasil diperbarui.","success")):(await A(s,h()),n("Game baru berhasil ditambahkan.","success")),o(p),m(null),u()}catch(d){n(d.message||"Operasi gagal. Coba lagi.","error")}},_=a=>{m(a.id),o({title:a.title||"",developer:a.developer||"",publisher:a.publisher||"",platform:a.platform||"",mode:a.mode||"",genres:a.genres||"",release_date:a.release_date||"",description:a.description||"",cover_image:a.cover_image||""}),window.scrollTo({top:0,behavior:"smooth"})},w=()=>{m(null),o(p)},E=async a=>{if(window.confirm("Hapus game ini?")){try{await L(a,h()),u()}catch(d){n(d.message||"Gagal menghapus game.","error");return}n("Game berhasil dihapus.","success")}};return!t||t.user.role!=="ADMIN"&&t.user.role!=="SUPER_ADMIN"?e.jsxs("div",{className:`admin-layout ${c==="light"?"theme-light":""}`,children:[e.jsx(g,{active:"Kelola Game"}),e.jsx("main",{className:"admin-content",children:e.jsx("p",{className:"error-text",children:"Akses ditolak."})})]}):e.jsxs("div",{className:`admin-layout ${c==="light"?"theme-light":""}`,children:[e.jsx(g,{active:"Kelola Game"}),e.jsxs("main",{className:"admin-content",children:[e.jsx("div",{className:"admin-content__header",children:e.jsxs("div",{children:[e.jsx("h1",{children:"Kelola Game"}),e.jsx("p",{className:"muted-text",children:"Tambah, edit, atau hapus entri game lokal."})]})}),e.jsxs("div",{className:"card",children:[e.jsx(v,{title:r?"Perbarui Game":"Tambah Game",subtitle:r?"Sedang mengedit data game yang dipilih.":void 0}),e.jsxs("form",{className:"admin-form",onSubmit:S,children:[e.jsxs("div",{className:"admin-form__grid",children:[e.jsxs("label",{children:["Judul",e.jsx("input",{name:"title",value:s.title,onChange:i})]}),e.jsxs("label",{children:["Developer",e.jsx("input",{name:"developer",value:s.developer,onChange:i})]}),e.jsxs("label",{children:["Publisher",e.jsx("input",{name:"publisher",value:s.publisher,onChange:i})]}),e.jsxs("label",{children:["Platform",e.jsx("input",{name:"platform",placeholder:"PC, Mobile",value:s.platform,onChange:i})]}),e.jsxs("label",{children:["Mode",e.jsxs("select",{name:"mode",value:s.mode,onChange:i,children:[e.jsx("option",{value:"",children:"Pilih Mode"}),e.jsx("option",{value:"Singleplayer",children:"Singleplayer"}),e.jsx("option",{value:"Co-op",children:"Co-op"}),e.jsx("option",{value:"Single & Co-op",children:"Single & Co-op"}),e.jsx("option",{value:"Multiplayer",children:"Multiplayer"})]})]}),e.jsxs("label",{children:["Genre",e.jsx("input",{name:"genres",placeholder:"Aksi, RPG",value:s.genres,onChange:i})]}),e.jsxs("label",{children:["Tanggal Rilis",e.jsx("input",{name:"release_date",placeholder:"2024-10-10",value:s.release_date,onChange:i})]}),e.jsxs("label",{children:["Cover Image URL",e.jsx("input",{name:"cover_image",placeholder:"https://...",value:s.cover_image,onChange:i})]})]}),e.jsxs("label",{children:["Deskripsi",e.jsx("textarea",{name:"description",rows:4,value:s.description,onChange:i})]}),e.jsxs("div",{className:"admin-form__actions",children:[e.jsx("button",{type:"submit",className:"btn-primary",children:r?"Update Game":"Simpan Game"}),r&&e.jsx("button",{type:"button",className:"btn-outline",onClick:w,children:"Batalkan Edit"})]})]})]}),e.jsxs("div",{className:"card",style:{marginTop:"2rem"},children:[e.jsx(v,{title:"Daftar Game"}),y?e.jsx("p",{children:"Sedang memuat daftar game..."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cover"}),e.jsx("th",{children:"Judul"}),e.jsx("th",{children:"Developer"}),e.jsx("th",{children:"Platform"}),e.jsx("th",{children:"Mode"}),e.jsx("th",{children:"Genre"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Aksi"})]})}),e.jsx("tbody",{children:N.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:a.cover_image,alt:a.title,className:"table-cover"})}),e.jsx("td",{children:a.title}),e.jsx("td",{children:a.developer}),e.jsx("td",{children:a.platform}),e.jsx("td",{children:a.mode||"-"}),e.jsx("td",{children:a.genres}),e.jsx("td",{children:Number(a.avg_rating||0).toFixed(1)}),e.jsxs("td",{className:"table-actions",children:[e.jsx("button",{type:"button",className:"btn-outline btn-small",onClick:()=>_(a),children:"Edit"}),e.jsx("button",{type:"button",className:"btn-danger btn-small",onClick:()=>E(a.id),children:"Hapus"})]})]},a.id))})]})})]})]})]})};export{U as default};
