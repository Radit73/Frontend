import{r as s,u as R,j as a,a as F}from"./index-_RlfeBLV.js";import{C as c,B as J,a as M,L as O,b as U,p as $,c as z,d as I}from"./index-CciEPKy6.js";import{G as V}from"./GameCard-BoOCudp_.js";import{g as C}from"./theme-eDaETbEk.js";c.register(M,O,U,$,z,I);c.defaults.color="#e5e7eb";c.defaults.borderColor="rgba(255, 255, 255, 0.08)";const K=()=>{const[m,k]=s.useState([]),[A,G]=s.useState(!0),[L,y]=s.useState(""),[p,E]=s.useState(""),[d,g]=s.useState("ALL"),[h,w]=s.useState("ALL"),[u,B]=s.useState(["ALL"]),[N,P]=s.useState(["ALL"]),[x,b]=R(),[n,T]=s.useState(()=>C());s.useEffect(()=>{const e=()=>T(C());return window.addEventListener("theme-changed",e),()=>window.removeEventListener("theme-changed",e)},[]),s.useEffect(()=>{c.defaults.color=n==="light"?"#111827":"#e5e7eb",c.defaults.borderColor=n==="light"?"rgba(185, 28, 28, 0.18)":"rgba(255, 255, 255, 0.08)"},[n]),s.useEffect(()=>{const e=document.body;return e.classList.add("theme-page-games"),n==="light"?e.classList.add("theme-light"):e.classList.remove("theme-light"),()=>{e.classList.remove("theme-page-games"),e.classList.remove("theme-light")}},[n]),s.useEffect(()=>{(async()=>{try{const t=await F();k(t);const r=new Set,i=new Set;t.forEach(l=>{(l.genres?l.genres.split(",").map(o=>o.trim()).filter(Boolean):[]).forEach(o=>r.add(o)),(l.platform?l.platform.split(",").map(o=>o.trim()).filter(Boolean):[]).forEach(o=>i.add(o))}),B(["ALL",...Array.from(r)]),P(["ALL",...Array.from(i)])}catch(t){y(t.message)}finally{G(!1)}})()},[]),s.useEffect(()=>{const e=x.get("genre");e&&u.includes(e)?g(e):e&&!u.includes(e)&&g("ALL")},[x,u]);const j=s.useMemo(()=>m.filter(e=>{const t=p.trim().toLowerCase(),r=t.length===0||e.title.toLowerCase().includes(t)||(e.developer||"").toLowerCase().includes(t),i=e.genres?e.genres.split(",").map(o=>o.trim().toLowerCase()):[],l=d==="ALL"||i.includes(d.toLowerCase()),S=e.platform?e.platform.split(",").map(o=>o.trim().toLowerCase()):[],v=h==="ALL"||S.includes(h.toLowerCase());return r&&l&&v}),[m,p,d,h]),f=s.useMemo(()=>{const e={};return m.forEach(t=>{const r=(t.platform||"").split(",").map(l=>l.trim()).filter(Boolean);(r.length>0?r:["Tidak ada platform"]).forEach(l=>{e[l]=(e[l]||0)+1})}),Object.entries(e).map(([t,r])=>({platform:t,count:r})).sort((t,r)=>r.count-t.count)},[m]),_={labels:f.map(e=>e.platform),datasets:[{label:"Jumlah Game",data:f.map(e=>e.count),backgroundColor:"rgba(99, 102, 241, 0.55)",borderColor:"#6366f1",borderWidth:1.5,borderRadius:10,maxBarThickness:38}]},D={indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`Jumlah game: ${e.parsed.x}`}}},scales:{x:{beginAtZero:!0,grid:{color:n==="light"?"rgba(185, 28, 28, 0.12)":"rgba(255, 255, 255, 0.08)"},ticks:{precision:0,stepSize:1,color:n==="light"?"#111827":"#e5e7eb"}},y:{grid:{display:!1},ticks:{color:n==="light"?"#111827":"#e5e7eb"}}}};return a.jsxs("div",{className:`page game-list-page section ${n==="light"?"theme-light":""}`,children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h2",{children:"Semua Game Lokal Indonesia"}),a.jsx("p",{children:"Filter berdasarkan genre favoritmu atau cari judul yang kamu inginkan."})]}),a.jsxs("div",{className:"game-list__filters card",children:[a.jsx("input",{type:"text",placeholder:"Cari judul atau developer...",value:p,onChange:e=>E(e.target.value)}),a.jsx("select",{value:d,onChange:e=>{const t=e.target.value;g(t),b(t&&t!=="ALL"?{genre:t}:{})},children:u.map(e=>a.jsx("option",{value:e,children:e==="ALL"?"Semua Genre":e},e))}),a.jsx("select",{value:h,onChange:e=>w(e.target.value),children:N.map(e=>a.jsx("option",{value:e,children:e==="ALL"?"Semua Platform":e},e))})]}),L&&a.jsx("p",{className:"error-text",children:L}),A?a.jsx("p",{children:"Sedang memuat daftar game..."}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"game-grid game-grid--enhanced",children:[j.length===0&&a.jsx("p",{className:"muted-text",children:"Tidak ada game yang cocok dengan filter."}),j.map(e=>a.jsx(V,{game:e},e.id))]}),a.jsxs("div",{className:"card chart-card chart-card--below-grid",children:[a.jsxs("div",{className:"chart-card__header",children:[a.jsx("h3",{children:"Distribusi Game per Platform"}),a.jsx("p",{className:"muted-text",children:"Data akan menyesuaikan otomatis saat platform baru ditambahkan."})]}),f.length===0?a.jsx("p",{children:"Belum ada data platform untuk ditampilkan."}):a.jsx("div",{className:"chart-container",children:a.jsx(J,{data:_,options:D})})]})]})]})};export{K as default};
